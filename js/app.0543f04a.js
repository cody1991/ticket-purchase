(function(t){function e(e){for(var a,r,o=e[0],i=e[1],u=e[2],f=0,h=[];f<o.length;f++)r=o[f],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a]);l&&l(e);while(h.length)h.shift()();return c.push.apply(c,u||[]),s()}function s(){for(var t,e=0;e<c.length;e++){for(var s=c[e],a=!0,o=1;o<s.length;o++){var i=s[o];0!==n[i]&&(a=!1)}a&&(c.splice(e--,1),t=r(r.s=s[0]))}return t}var a={},n={app:0},c=[];function r(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=a,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,function(e){return t[e]}.bind(null,a));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/ticket-purchase/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=i;c.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0265":function(t,e,s){},"034f":function(t,e,s){"use strict";var a=s("85ec"),n=s.n(a);n.a},"158a":function(t,e,s){"use strict";var a=s("cda6"),n=s.n(a);n.a},"49bb":function(t,e,s){"use strict";var a=s("0265"),n=s.n(a);n.a},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("HelloWorld",{attrs:{msg:"Welcome to Your "+t.appName+" App"}}),t._m(0),t.jayChouConcert?s("intro",{attrs:{concert:t.jayChouConcert,users:t.users,refundRate:t.refundRate}}):t._e(),t.jayChouConcert&&t.isShowSeats?s("display-seats",{attrs:{seats:[].concat(t.jayChouConcert.seats)}}):t._e(),s("div",{staticClass:"btn",on:{click:t.handleStopStatus}},[t.stop?s("span",[t._v("开始售票")]):s("span",[t._v("停止售票")])]),s("display-users",{attrs:{users:t.displayUsers}})],1)},c=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",{staticClass:"github-intro"},[t._v(" 点击查看 "),s("a",{staticClass:"success",attrs:{href:"https://github.com/cody1991/ticket-purchase"}},[t._v(" GitHub仓库 ")]),t._v(" / "),s("a",{staticClass:"success",attrs:{href:"https://github.com/cody1991/ticket-purchase#url-%E5%8F%82%E6%95%B0%E4%BD%BF%E7%94%A8"}},[t._v(" 参数说明 ")])])}],r=(s("fb6a"),s("a434"),s("a9e3"),s("96cf"),s("1da1")),o=(s("99af"),s("a630"),s("a15b"),s("d81d"),s("b0c0"),s("4ec9"),s("d3b7"),s("ac1f"),s("3ca3"),s("1276"),s("ddb0"),s("3835")),i=s("d4ec"),u=s("bee2"),l=s("262e"),f=s("2caf"),h=(s("c975"),s("13d5"),s("841c"),s("5530"));function p(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="";while(t--)s+=e[Math.floor(Math.random()*e.length)];return s}function v(t,e){if(t>e){var s=[e,t];t=s[0],e=s[1]}return t+Math.floor(Math.random()*(e-t+1))}function d(t){return new Promise((function(e){setTimeout(e,t)}))}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search,e=t.slice(t.indexOf("?")+1).split("&");return e.reduce((function(t,e){var s=Object(h["a"])({},t),a=e.split("="),n=Object(o["a"])(a,2),c=n[0],r=n[1];return r&&(s[c]=decodeURIComponent(r)),s}),{})}var _=function(){function t(e){var s=e.block,a=void 0===s?5:s,n=e.front,c=void 0===n?50:n,r=e.back,o=void 0===r?100:r,u=e.step,l=void 0===u?2:u;if(Object(i["a"])(this,t),l>0&&o<c){var f=[c,o];o=f[0],c=f[1]}if(l<0&&c<o){var h=[c,o];o=h[0],c=h[1]}0===l&&alert("每排递增数量不能为0"),(c<=0||o<=0||a<=0)&&alert("每排的数量和区块数不能小于等于0"),this.block=a,this.front=c,this.back=o,this.step=l,this.sum=0,this.used=0,this.freeMap=new Map,this.floor=Math.floor((this.back-this.front)/this.step)+1;var p=this.front+this.step*(this.floor-1);p!==this.back&&(this.back=p),console.log("Seats init with \nblock ".concat(this.block," \nfront ").concat(this.front," \nback ").concat(this.back," \nstep ").concat(this.step," \nfloor ").concat(this.floor)),this.seats=[];for(var v=0;v<this.floor;v++){var d=(this.front+this.step*v)*this.block;this.seats[v]=[];for(var b=0;b<d;b+=1){var _={state:0,user:null,block:this.calcBlock(b,d,this.block)};this.seats[v].push(_),this.freeMap.set("".concat(v,"-").concat(b),_)}this.sum+=d}}return Object(u["a"])(t,[{key:"purchaseTicket",value:function(t){var e=t.ticket;this.used+=e;for(var s=e,a=[],n=0;n<this.floor;n+=1){for(var c=this.seats[n],r=c.length,o=0;o<r;o+=1)if(0===c[o].state&&0!==s&&(this.seats[n][o]=Object.assign(c[o],{state:1,user:t}),a.push({row:n,col:o,block:c[o].block}),s-=1),0===s)break;if(0===s)break}return a}},{key:"calcBlock",value:function(t,e,s){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[Math.floor(t/(e/s))]}},{key:"refundTicket",value:function(t){var e=this;t&&t.purchaseTicketPos&&0!==t.purchaseTicketPos.length&&(t.purchaseTicketPos.map((function(t){var s=t.row,a=t.col;e.seats[s][a]=Object.assign(e.seats[s][a],{state:0,user:null})})),this.used-=t.purchaseTicketPos.length)}},{key:"remain",get:function(){return this.sum-this.used}}]),t}(),k=_,C=function(t){Object(l["a"])(s,t);var e=Object(f["a"])(s);function s(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])(this,s),t=e.call(this,a),t.adjacentSeatCount=0,t.notAdjacentSeatCount=0,t}return Object(u["a"])(s,[{key:"getSeatInfo",value:function(t,e){var s=t[e],a=Object(o["a"])(s,2),n=a[0],c=a[1],r=n.split("-"),i=Object(o["a"])(r,2),u=i[0],l=i[1];return u=Number(u),l=Number(l),{row:u,col:l,value:c}}},{key:"getSeatMin",value:function(t,e){var s=null;while(this.freeMap.has("".concat(t,"-").concat(e))&&e>=0)this.freeMap.get("".concat(t,"-").concat(e))&&(s={row:t,col:e}),e--;return s}},{key:"getSeatMax",value:function(t,e,s){var a=null;while(this.freeMap.has("".concat(t,"-").concat(e))&&e<s)this.freeMap.get("".concat(t,"-").concat(e))&&(a={row:t,col:e}),e++;return a}},{key:"deleteMapKeys",value:function(t,e){e.map((function(e){t.delete(e)}))}},{key:"assignSeat",value:function(t,e,s,a){var n="".concat(t,"-").concat(e);this.seats[t][e]=Object.assign(this.seats[t][e],{state:1,user:a});var c=s.get(n);return{row:t,col:e,block:c.block}}},{key:"purchaseTicket",value:function(t){var e=t.ticket;if(console.log("```````"),console.log("".concat(t.name," 开始购票，票数为 ").concat(e)),!(this.remain<e)){var s=Array.from(this.freeMap.entries()),a=[],n=[],c=!1,r=new Map;while(!c&&r.size<this.freeMap.size){var o=v(0,this.freeMap.size-1),i=this.getSeatInfo(s,o),u=i.row,l=i.col;if(r.get("".concat(u,"-").concat(l)))console.log("这个已经不能再用啦");else{var f={row:u,col:l},h={row:u,col:l},p=this.seats[u].length;if(l-1>=0){var d=this.getSeatMin(u,l-1);d&&(f=d)}if(l+1<p){var b=this.getSeatMax(u,l+1,p);b&&(h=b)}if(h.col-f.col+1<e)for(var _=f.col;_<=h.col;_+=1)r.set("".concat(u,"-").concat(_),!0);else{for(var k=f,C=0;C<e;C+=1){var m=k.row,g=k.col;a.push(this.assignSeat(m,g,this.freeMap,t)),n.push("".concat(m,"-").concat(g)),k.col+=1}this.deleteMapKeys(this.freeMap,n),this.used+=e,this.adjacentSeatCount+=1,t.isAdjacentSeat=!0,c=!0}}}if(r.size===this.freeMap.size&&r.size>0){console.log("无法邻座"),this.notAdjacentSeatCount+=1;for(var y=v(0,this.freeMap.size-1),w=0;w<e;w+=1){var j=this.getSeatInfo(s,y),S=j.row,M=j.col;a.push(this.assignSeat(S,M,this.freeMap,t)),n.push("".concat(S,"-").concat(M)),y+1<this.freeMap.size?y+=1:y=0}this.deleteMapKeys(this.freeMap,n),t.isAdjacentSeat=!1,this.used+=e}return a.length>0?(console.log("他选择了",a.map((function(t){return"".concat(t.block,"区").concat(t.row,"排").concat(t.col,"座")})).join(", ")),console.log("```````")):console.log("他购票失败"),a}console.log("票太少啦")}},{key:"refundTicket",value:function(t){var e=this;t&&t.purchaseTicketPos&&0!==t.purchaseTicketPos.length&&(t.purchaseTicketPos.map((function(t){var s=t.row,a=t.col;e.seats[s][a]=Object.assign(e.seats[s][a],{state:0,user:null});var n="".concat(s,"-").concat(a);e.freeMap.set(n,{row:s,col:a,block:e.seats[s][a].block})})),this.used-=t.purchaseTicketPos.length,t.isAdjacentSeat?this.adjacentSeatCount--:this.notAdjacentSeatCount--)}}]),s}(k),m=C,g=s("ade3"),y=function t(){Object(i["a"])(this,t),this.name=p(v(5,10)),this.id=p(32),this.ticket=v(1,t.ticketLimit),this.status="INIT"};Object(g["a"])(y,"ticketLimit",5);var w=y,j=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"hello"},[s("h1",[t._v(t._s(t.msg))])])},S=[],M={name:"HelloWorld",props:{msg:String}},O=M,T=(s("919c"),s("2877")),x=Object(T["a"])(O,j,S,!1,null,"737cddd0",null),P=x.exports,A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"users"},t._l(t.users,(function(e){return s("div",{key:e.id,staticClass:"user"},[t._v(" 用户 "+t._s(e.name)+" "),"SUCCESS"===e.status?s("span",{staticClass:"success"},[t._v(" 购买了 "+t._s(e.ticket)+" 张票"),e.isAdjacentSeat?s("span",{staticClass:"success"},[t._v("（邻座）")]):s("span",{staticClass:"warning"},[t._v("（非邻座）")]),s("div",{staticClass:"pos-group"},t._l(e.purchaseTicketPos,(function(e){return s("span",{key:e.row+"-"+e.col,staticClass:"pos"},[t._v(t._s(e.block)+"区"+t._s(e.row+1)+"排"+t._s(e.col+1)+"座")])})),0)]):"FAIL"===e.status?s("span",{staticClass:"error"},[t._v(" 购票失败，需要购买 "+t._s(e.ticket)+" 张 ")]):"REFUND"===e.status?s("span",{staticClass:"warning"},[t._v(" 退票成功 "),s("div",{staticClass:"pos-group"},t._l(e.purchaseTicketPos,(function(e){return s("span",{key:e.row+"-"+e.col,staticClass:"pos"},[t._v(t._s(e.block)+"区"+t._s(e.row+1)+"排"+t._s(e.col+1)+"座")])})),0)]):t._e()])})),0)},N=[],E={props:{users:{type:Array,default:function(){return[]}}}},R=E,I=(s("158a"),Object(T["a"])(R,A,N,!1,null,"867235cc",null)),U=I.exports,F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._l(t.seats,(function(e,a){return s("div",{key:a,staticClass:"seat-rows"},t._l(e,(function(e,n){return s("div",{key:n,staticClass:"seat-cols"},[s("div",{staticClass:"seat",class:{occupy:e.state},on:{click:function(s){return t.showInfo(e,a,n)}}})])})),0)})),s("p",{staticClass:"intro"},[t._v("可点击座位查看具体信息")]),s("seat-dialog",{attrs:{seat:t.seat},on:{close:t.closeInfo},model:{value:t.seatShow,callback:function(e){t.seatShow=e},expression:"seatShow"}})],2)},L=[],D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.show?s("transition",{attrs:{name:"fade"}},[t.seat&&t.seat.info?s("div",{staticClass:"dialog-wrapper"},[s("div",{staticClass:"mask",on:{click:t.close}}),s("div",{staticClass:"dialog"},[s("p",[t._v(t._s(t.seat.info.block)+"区"+t._s(t.seat.row+1)+"排"+t._s(t.seat.col+1)+"座")]),s("p",[t.seat.info.state&&t.seat.info.user&&t.seat.info.user.name?s("span",[t._v("已被购买，购买人为 "+t._s(t.seat.info.user.name))]):s("span",[t._v(" 暂未被购买 ")])]),s("div",{staticClass:"btn",on:{click:t.close}},[t._v("我知道了")])])]):t._e()]):t._e()},z=[],$={props:{value:{type:Boolean,default:!1},seat:{type:Object,default:function(){}}},watch:{value:function(t){this.show=t}},data:function(){return{show:this.value}},methods:{close:function(){this.$emit("close")}}},B=$,H=(s("fbd7"),Object(T["a"])(B,D,z,!1,null,"c75d1e3a",null)),W=H.exports,K={components:{SeatDialog:W},props:{seats:{type:Array,default:function(){return[]}}},data:function(){return{seat:{},seatShow:!0}},methods:{showInfo:function(t,e,s){console.log("showinfo"),this.seat={info:t,row:e,col:s},this.seatShow=!0},closeInfo:function(){this.seatShow=!1}}},J=K,G=(s("aa9b"),Object(T["a"])(J,F,L,!1,null,"412a40e8",null)),Y=G.exports,Q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"intro"},[s("p",[t._v(" 一共有"),s("span",[t._v(t._s(t.concert.block))]),t._v("个区，每一排递增"),s("span",[t._v(t._s(t.concert.step))]),t._v("个座位，共"),s("span",[t._v(t._s(t.concert.sum))]),t._v("个座位 ")]),s("p",[t._v(" 第1排有"),s("span",[t._v(t._s(t.concert.front))]),t._v("个座位，最后1排有"),s("span",[t._v(t._s(t.concert.back))]),t._v("个座位 ")]),s("p",[t._v(" 已经售出"),s("span",[t._v(t._s(t.concert.used))]),t._v("个座位，还剩下"),s("span",[t._v(t._s(t.concert.remain))]),t._v("个座位 ")]),s("div",{staticClass:"hr"}),s("p",[t._v(" 一共有"),s("span",[t._v(t._s(t.users.length))]),t._v("个用户购票，其中购票成功的有 "),s("span",{staticClass:"success"},[t._v(t._s(t.usersSuccess.length))]),t._v("个 ")]),s("p",[t._v(" 购买了邻座的用户有"),s("span",{staticClass:"success"},[t._v(t._s(t.concert.adjacentSeatCount))]),t._v("个，非邻座有 "),s("span",{staticClass:"warning"},[t._v(t._s(t.concert.notAdjacentSeatCount))]),t._v("个 ")]),s("p",[t._v(" 一共有"),s("span",{staticClass:"warning"},[t._v(t._s(t.usersRefund.length))]),t._v("个用户退票，用户退票的概率为 "),s("span",{staticClass:"warning"},[t._v(t._s(t.refundRate))])]),s("p",[t._v(" 一共有"),s("span",{staticClass:"error"},[t._v(t._s(t.usersFail.length))]),t._v("个用户购票失败 ")]),s("div",{staticClass:"seat"}),t._v(" 代表空闲座位 "),s("div",{staticClass:"seat occupy"}),t._v(" 代表已占用座位 ")])},V=[],X=(s("4de4"),{props:{concert:{type:Object,default:function(){}},users:{type:Array,default:function(){return[]}},refundRate:{type:Number,default:function(){return 0}}},computed:{usersSuccess:function(){return this.users.filter((function(t){return"SUCCESS"===t.status}))},usersFail:function(){return this.users.filter((function(t){return"FAIL"===t.status}))},usersRefund:function(){return this.users.filter((function(t){return"REFUND"===t.status}))}}}),Z=X,q=(s("49bb"),Object(T["a"])(Z,Q,V,!1,null,"ab2d952a",null)),tt=q.exports;w.ticketLimit=5;var et=b(),st={name:"App",data:function(){return{displayUsersLen:Number(et.displayUsersLen)>0?Number(et.displayUsersLen)>0:25,sleepMax:Number(et.sleepMax)>0?Number(et.sleepMax):100,refundRate:Number(et.refundRate)>=0?Number(et.refundRate):.2,block:Number(et.block)||3,front:Number(et.front)||2,back:Number(et.back)||20,step:Number(et.step)||1,appName:"Ticket Purchase",jayChouConcert:null,seats:[],users:[],stop:!1}},components:{HelloWorld:P,DisplayUsers:U,DisplaySeats:Y,Intro:tt},beforeDestroy:function(){this.jayChouConcert=null},computed:{displayUsers:function(){return this.users.slice(0,this.displayUsersLen)},isShowSeats:function(){if(this.jayChouConcert){var t=this.jayChouConcert,e=t.back,s=t.block,a=t.front,n=Math.max(e,a);if(n*s<100)return!0}return!1}},methods:{handleStopStatus:function(){this.stop=!this.stop},init:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var s,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.jayChouConcert=new m({block:t.block,front:t.front,back:t.back,step:t.step}),console.log(t.jayChouConcert);case 2:if(!t.jayChouConcert||!t.jayChouConcert.remain){e.next=10;break}return e.next=5,d(v(0,t.sleepMax));case 5:if(t.jayChouConcert&&!t.stop){e.next=7;break}return e.abrupt("continue",2);case 7:Math.random()>t.refundRate?(s=new w,t.jayChouConcert&&t.jayChouConcert.remain-s.ticket>=0?(s.purchaseTicketPos=t.jayChouConcert.purchaseTicket(s),s.purchaseTicketPos&&s.purchaseTicketPos.length>0?s.status="SUCCESS":(s.status="FAIL",s.purchaseTicketPos=[])):(s.status="FAIL",s.purchaseTicketPos=[]),t.users.unshift(s)):t.users.length&&t.users.length>0&&(a=v(0,t.users.length-1),n=t.users[a],"SUCCESS"===n.status&&(n.status="REFUND",t.users.splice(a,1),t.users.unshift(n),t.jayChouConcert.refundTicket(n))),e.next=2;break;case 10:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.init()}},at=st,nt=(s("034f"),Object(T["a"])(at,n,c,!1,null,null,null)),ct=nt.exports;s("f5df1");a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(ct)}}).$mount("#app")},"85ec":function(t,e,s){},"919c":function(t,e,s){"use strict";var a=s("9e83"),n=s.n(a);n.a},"9e83":function(t,e,s){},aa9b:function(t,e,s){"use strict";var a=s("b9a0"),n=s.n(a);n.a},b9a0:function(t,e,s){},c572:function(t,e,s){},cda6:function(t,e,s){},fbd7:function(t,e,s){"use strict";var a=s("c572"),n=s.n(a);n.a}});
//# sourceMappingURL=app.0543f04a.js.map